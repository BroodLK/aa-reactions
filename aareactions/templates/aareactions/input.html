<!-- templates/reprocessor/input.html -->
{% extends "base.html" %}
{% block content %}
<h2>Refine & Reaction Planner</h2>
<form method="post">
  {% csrf_token %}
  <div>
    {{ form.lines.label_tag }}<br />
    {{ form.lines }}
  </div>
  <div style="margin-top:8px">
    {{ form.refine_rate.label_tag }}<br />
    {{ form.refine_rate }}
  </div>
  <div style="margin-top:12px">
    <button type="submit">Plan</button>
  </div>
</form>

{% if refined %}
<hr />
<h3>Refined Stock (after rate {{ refine_rate }})</h3>
<table>
  <tr><th>Type</th><th>Qty</th></tr>
  {% for r in refined %}
  <tr><td>{{ r.type_name }}</td><td>{{ r.qty }}</td></tr>
  {% endfor %}
</table>
{% endif %}

{% if plans %}
<hr />
<h3>Reaction Plans (two-pass chain)</h3>
{% for p in plans %}
<div style="margin:10px 0;padding:8px;border:1px solid #ddd">
  <strong>{{ p.name }}</strong> — Runs: {{ p.runs }}
  {% if p.consumed %}
  <div>Consumed:</div>
  <ul>
    {% for c in p.consumed %}
    <li>{{ c.type_name }} × {{ c.qty }}</li>
    {% endfor %}
  </ul>
  {% endif %}
  {% if p.products %}
  <div>Products:</div>
  <ul>
    {% for pr in p.products %}
    <li>{{ pr.type_name }} × {{ pr.qty }}</li>
    {% endfor %}
  </ul>
  {% endif %}
  {% if p.missing %}
  <div>Missing:</div>
  <ul>
    {% for m in p.missing %}
    <li>{{ m.type_name }} × {{ m.qty }}</li>
    {% endfor %}
  </ul>
  {% endif %}
</div>
{% endfor %}
{% endif %}

{% if leftovers %}
<hr />
<h3>Leftovers</h3>
<table>
  <tr><th>Type</th><th>Qty</th></tr>
  {% for r in leftovers %}
  <tr><td>{{ r.type_name }}</td><td>{{ r.qty }}</td></tr>
  {% endfor %}
</table>
{% endif %}

{% if suggestions %}
<hr />
<h3>Suggestions</h3>
{% for s in suggestions %}
<div style="margin:10px 0;padding:8px;border:1px solid #ddd">
  <strong>{{ s.reaction_name }}</strong>
  <div>Missing to enable:</div>
  <ul>
    {% for m in s.missing %}
    <li>{{ m.type_name }} × {{ m.qty }}</li>
    {% endfor %}
  </ul>
</div>
{% endfor %}
{% endif %}
{% endblock %}
